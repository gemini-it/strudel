import { MiniRepl } from '../../../website/src/docs/MiniRepl';
import { JsDoc } from '../../../website/src/docs/JsDoc';

# Mouvement de l'appareil

Le module Devicemotion vous permet d'utiliser les capteurs de mouvement de votre appareil mobile (accéléromètre, gyroscope et capteurs d'orientation) pour contrôler les paramètres musicaux en temps réel. Cela ouvre des opportunités pour des interactions musicales expressives basées sur le mouvement.

## Configuration de base

Tout d'abord, vous devez activer la détection de mouvement de l'appareil :

<MiniRepl client:idle tune={`enableMotion()`} />

Cela demandera à l'utilisateur l'autorisation d'accéder aux capteurs de mouvement de l'appareil.

## Paramètres de mouvement disponibles

Vous pouvez accéder à différents types de données de mouvement :

| Mouvement           | Noms longs et alias                                                                                                                  | Description                                                                                                                                              |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------- |
| Accélération        | accelerationX (accX), accelerationY (accY), accelerationZ (accZ)                                                                    | Mesure l'accélération linéaire de l'appareil, à l'exclusion de la gravité. Les valeurs brutes sont normalisées à partir de la force g.             |
| Gravité             | gravityX (gravX), gravityY (gravY), gravityZ (gravZ)                                                                                | Indique l'orientation de l'appareil par rapport à la gravité terrestre. Les valeurs brutes sont normalisées à partir de ±9,81 m/s².             |
| Rotation            | rotationAlpha (rotA, rotZ), rotationBeta (rotB, rotX), rotationGamma (rotG, rotY)                                                   | Mesure le taux de rotation autour de chaque axe. Les valeurs brutes (±180°/s) sont normalisées.                                                  |
| Orientation         | orientationAlpha (oriA, oriZ), orientationBeta (oriB, oriX), orientationGamma (oriG, oriY)                                          | Orientation relative par rapport à la position de départ de l'appareil. Normalisé de :<br/>- Alpha : 0° à 360°<br/>- Bêta : -180° à 180°<br/>- Gamma : -90° à 90° |
| Orientation absolue | absoluteOrientationAlpha (absOriA, absOriZ), absoluteOrientationBeta (absOriB, absOriX), absoluteOrientationGamma (absOriG, absOriY) | **Non disponible pour iOS** <br/> Orientation référencée par rapport à la Terre en utilisant un magnétomètre. Même normalisation que l'Orientation. |

Note:

- Toutes les valeurs de mouvement sont normalisées à une plage de 0 à 1.
- Tous les appareils ne disposent pas des mêmes capteurs.
  Vérifiez l'[API DeviceMotionEvent](https://developer.mozilla.org/en-US/docs/Web/API/DeviceMotionEvent) pour la compatibilité du navigateur.
- Référez-vous à [Données d'orientation et de mouvement expliquées](https://developer.mozilla.org/en-US/docs/Web/API/Device_orientation_events/Orientation_and_motion_data_explained) pour plus de détails.

### Orientation vs Orientation Absolue

La différence fondamentale entre l'orientation régulière et l'orientation absolue est la suivante :

- L'orientation régulière (`oriX/Y/Z`) mesure les changements relatifs de l'orientation de l'appareil par rapport à sa position de départ.
- L'orientation absolue (`absOriX/Y/Z`) mesure l'orientation par rapport au champ magnétique terrestre et à la gravité, fournissant des valeurs absolues cohérentes quelle que soit la position de départ.

Par exemple, si vous faites pivoter votre appareil de 90 degrés dans le sens des aiguilles d'une montre, puis en arrière :

- L'orientation régulière montrera un changement pendant la rotation, mais reviendra aux valeurs initiales.
- L'orientation absolue affichera l'orientation réelle de la boussole tout au long.

Ceci rend l'orientation absolue particulièrement utile pour créer des interactions musicales basées sur la direction - par exemple, les interprètes faisant face au nord pourraient jouer une mélodie tandis que ceux faisant face au sud en jouent une autre, créant ainsi des performances d'ensemble spatialement conscientes. L'orientation régulière, quant à elle, est mieux adaptée à la détection des mouvements et des gestes relatifs, quelle que soit la direction dans laquelle l'interprète est orienté.

## Exemple de base

Voici un exemple simple qui utilise le mouvement de l'appareil pour contrôler un synthétiseur :

<MiniRepl
  client:idle
  tune={`enableMotion()
// Create a simple melody
$:n("0 1 3 5")
.scale("C:major")
// Use tilt (gravity) to control filter
.lpf(gravityY.range(200, 2000)) // tilt forward/back for filter cutoff
// Use rotation to control effects
.room(rotZ.range(0, 0.8)) // rotate device for reverb amount
.gain(oriX.range(0.2, 0.8)) // tilt left/right for volume
.sound("sawtooth")`}
/>

## Conseils d'utilisation des commandes de mouvement

1. Utilisez `.range(min, max)` pour mapper les valeurs des capteurs à des plages musicalement utiles.
2. Envisagez d'utiliser `.segment()` pour lisser les changements rapides des valeurs des capteurs.

## Débogage

Vous pouvez utiliser `segment(16).log()` pour voir les valeurs brutes de n'importe quel capteur de mouvement :

```javascript
$_: accX.segment(16).log(); // logs acceleration values to the console
```

Ceci est utile pour calibrer vos plages et comprendre comment votre appareil réagit à différents mouvements.

N'oubliez pas que le mouvement de l'appareil fonctionne mieux sur les appareils mobiles et peut ne pas être disponible sur tous les navigateurs de bureau. Testez toujours vos pièces contrôlées par le mouvement sur le type d'appareil cible !
